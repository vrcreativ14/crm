{% extends 'accounts/settings_base.djhtml' %}
{% load static %}
{% load humanize %}
{% load permission_tags %}

{% block page_title %}Users{% endblock %}
{% block body_class %}company-agents{% endblock %}

{% block settings_content %}

    <div class="row justify-content-md-center p-t-60">
        <div class="col-lg-9">
            <div class="card m-b-20">
                <div class="row">
                    <div class="col col-6"><h4 class="header-title m-l-15 m-t-15 m-b-0">Users</h4></div>
                    <div class="col col-6">
                        {% if user|can:'list_users' %}
                            <a class="btn btn-primary btn-sm float-right mt-3 mr-3 invite-users-button" href="{% url 'accounts:agent-invites' %}">
                                <i class="ti-plus"></i>&nbsp;&nbsp;Invite Users
                            </a>
                        {% endif %}
                    </div>
                </div>

                <hr />

                {% if agents %}
                    <small class="table_counts">{{ agents.paginator.count }} records found</small>
                    <table class="table felix-table" cellspacing="0" width="90%">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Workspaces</th>
                                <th>Role</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody class="felix-table-body">
                            {% for agent in agents %}
                                <tr
                                    id="tr_{{ agent.pk }}"
                                    {% if agent.user_id == request.user.pk %}
                                        data-url="{% url 'accounts:profile' %}"
                                    {% else%}
                                        data-url="{% url 'accounts:agent-edit' pk=agent.pk %}"
                                    {% endif %}
                                    >
                                    <td>
                                        {{ agent.user.get_full_name }}
                                        <div class="text-muted font-12">{{ agent.user.username }}</div>
                                    </td>
                                    <td>{{ agent.get_allowed_workspaces_count }}</td>
                                    <td class="capitalize">
                                        {{ agent.user.userprofile.get_assigned_role }}
                                    </td>
                                    <td class="link">
                                        <a class="text-primary" href="{% if agent.user_id == request.user.pk %}
                                            {% url 'accounts:profile' %}
                                        {% else%}
                                            {% url 'accounts:agent-edit' pk=agent.pk %}
                                        {% endif %}">Edit</a> | <a data-id="{{ agent.pk }}" data-status-url="{% url 'accounts:agent-deals-and-delete' pk=agent.pk %}" class="remove-agent text-danger link" href="javascript:void(0)">Delete</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    {% if agents %}
                    <div class="squeeze">
                        <center>
                            <ul class="pagination m-t-20 p-b-30">
                                {% for page_number in agents.paginator.page_range %}
                                    <li class="page-item {% if page_number == agents.number %}active{% endif %}">
                                        {% if page_number == agents.number %}
                                            <a href="javascript:" class="page-link active">{{ page_number }}</a>
                                        {% else %}
                                            <a href="?page={{ page_number }}" class="page-link">{{ page_number }}</a>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </center>
                    </div>
                    {% endif %}
                {% else %}
                    <center>
                        <p class="font-16 m-60 p-b-60">You do not have any user. Please <a href="{% url 'accounts:agent-new' %}" class="">click here</a> to add one.</p>
                    </center>
                {% endif %}
            </div>
        </div>
    </div>

    {% include "accounts/agent_remove_modal.djhtml" %}

{% endblock %}
